<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Forecast</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #chart {
      max-width: 650px;
      margin: 35px auto;
    }
  </style>
</head>
<body>
  <h1>Stock Forecast</h1>
  <select id="stockSelector">
    <option value="AAPL">Apple</option>
    <option value="GOOGL">Google</option>
    <option value="MSFT">Microsoft</option>
  </select>
  <div id="chart"></div>

  <script>
    document.getElementById('stockSelector').addEventListener('change', fetchStockData);

    async function fetchStockData() {
      const symbol = document.getElementById('stockSelector').value;
      const apiKey = 'EWZJ4NOMB0U51N69';
      const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${apiKey}`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const timeSeries = data['Time Series (Daily)'];
        const dates = Object.keys(timeSeries).reverse();
        const prices = dates.map(date => parseFloat(timeSeries[date]['4. close']));

        const forecast6Months = await forecast(prices, 180);
        const forecast1Year = await forecast(prices, 365);

        renderChart(dates, prices, forecast6Months, forecast1Year);
      } catch (error) {
        console.error('Error fetching stock data:', error);
      }
    }

    async function forecast(prices, days) {
      const model = tf.sequential();
      model.add(tf.layers.dense({ units: 1, inputShape: [1] }));
      model.compile({ optimizer: 'sgd', loss: 'meanSquaredError' });

      const xs = tf.tensor2d(prices.map((_, i) => [i]), [prices.length, 1]);
      const ys = tf.tensor2d(prices, [prices.length, 1]);

      await model.fit(xs, ys, { epochs: 100 });

      const forecast = [];
      for (let i = 0; i < days; i++) {
        const prediction = model.predict(tf.tensor2d([[prices.length + i]], [1, 1]));
        forecast.push(prediction.dataSync()[0]);
      }
      return forecast;
    }

    function renderChart(dates, prices, forecast6Months, forecast1Year) {
      const futureDates6Months = Array.from({ length: 180 }, (_, i) => `Day ${i + 1}`);
      const futureDates1Year = Array.from({ length: 365 }, (_, i) => `Day ${i + 1}`);

      const options = {
        chart: {
          type: 'line'
        },
        series: [
          {
            name: 'Stock Price',
            data: prices
          },
          {
            name: '6 Months Forecast',
            data: [...Array(prices.length).fill(null), ...forecast6Months]
          },
          {
            name: '1 Year Forecast',
            data: [...Array(prices.length).fill(null), ...forecast1Year]
          }
        ],
        xaxis: {
          categories: [...dates, ...futureDates1Year]
        }
      };

      const chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();
    }

    // Fetch initial data
    fetchStockData();
  </script>
</body>
</html>
